---
title: "Fish FORWRD Database"
format: 
  dashboard:
    embed-resources: true
---

```{r echo=FALSE, message=FALSE, msg = F, warning = F, error = F}
library(gauntlet)
library(magrittr)
library(targets)
library(tidyverse, quietly = TRUE)

package_load_q = purrr::quietly(gauntlet::package_load)

tmp = c("tibble", "tidyverse", "magrittr","gauntlet"
        ,"gauntletReactable", "reactable", "reactablefmtr"
        ,"crosstalk", "plotly"
        ,"bslib","bsicons", "htmltools", "shiny") %>% 
  package_load_q()
```

```{r}
# setwd(here::here())
table_height = 500

# source(here::here("code/helpers_skankey.R"))
```

```{css}
.navbar {
background-color: #016FB1;
}

.cardSpecBig {
text-align: center;
font-size: large;
}

.cardcenter {
text-align: center;
}

.cardSpecSmall {
text-align: center;
font-size: small;
}
```

<!-- ```{js} -->
<!-- function filter_default(){ -->
<!--   document.getElementById("id_tble_project_summary_proj").getElementsByClassName("selectized")[0].selectize.setValue("Ex-1",false) -->
<!-- } -->

<!-- $(document).ready(filter_default); -->
<!-- ``` -->

```{r}
setwd(here::here())
tar_load_everything()

# tar_load(data_current_pro)
# tar_load(data_needed_pro)
# tar_load(viz_prj_timeline)
# tar_load(viz_proj_location_tree)
# tar_load(viz_proj_location_tree_needs)
# tar_load(viz_tble_crrnt_proj_shrt)
# tar_load(viz_tble_dcntr_acc)
# tar_load(viz_tble_dcntr_current)
# tar_load(viz_tble_dcntr_def)
# tar_load(viz_tble_dcntr_need)
# tar_load(viz_tble_dcntr_ref)
# tar_load(viz_tble_needs_proj_shrt_test)
# tar_load(viz_tble_project_summary)
# 
# tar_load(viz_viz_unaddressed_needs)
# tar_load(viz_tble_need_anmlgrp)
# tar_load(viz_tble_needs_proj_shrt)
# tar_load(viz_tble_agg_addrssd_gap)


```

# Welcome Page

## Row {height = "15%"}

::: cardSpecBig
Welcome to the <strong>Fish FORWRD Database</strong>\
Developed in Partnership by <strong>ROSA</strong>, <strong>Attentive Energy</strong>, and <strong>WSP</strong>\
![](../docs/rosa_logo.jpg){width="10%"} ![](../docs/ae_log_sm.png){width="10%"} ![](../docs/img-png-wsp-black.png){width="5%"}
:::

## Row {height="70%"}

### Column {width="60%"}

```{r}
bslib::card(
  bslib::card_body(
    shiny::markdown("
  <strong>Purpose of this Database</strong><br>
FishFORWRD is a catalog of all East Coast research, monitoring efforts, and stated research needs for offshore wind, fish, and fisheries.
The objective of FishFORWRD is to increase awareness of ongoing work, avoid duplication of efforts, and create a common understanding of research needs.
This tool is meant for research funders, fisheries and offshore wind researchers, offshore wind developers, and the public.

<strong>How to use this Dashboard</strong><br>
This dashboard is comprised of a number of tabs, each with their own purpose and functionality with features to help you explore page content or visuals.
All tables and plots are interactive and can be manipulated via the mouse.

<strong>Explanation of Tabs</strong>

<strong>[Current Projects:](#current-projects)</strong> View ongoing projects with high level attributes.

<strong>[Research Needs Gap Analysis:](#research-needs)</strong> Identify research gaps and explored unaddressed needs.

<strong>[View Database:](#database-center)</strong> Interact with raw data through user-friendly tools and download database directly.

<strong>[Submit Project:](#submit-project)</strong> Submit information to update and improve FishFORWRD.
")
  )
)
```


### Column {width="15%"}

```{r}
bslib::value_box(
  title = "Total Project Count"
  ,theme = bslib::value_box_theme(bg = "#016FB1", fg = "#e5f0f7")
  ,value = nrow(data_current_pro)
  ,full_screen = F
)
```

```{r}
bslib::value_box(
  title = "Total Unique Research Categories"
  ,theme = bslib::value_box_theme(bg = "#016FB1", fg = "#e5f0f7")
  ,value = length(unique(data_current_pro$research_category))
    ,full_screen = F
)
```

```{r}
bslib::value_box(
  title = "Total Identified Needs"
  ,theme = bslib::value_box_theme(bg = "#016FB1", fg = "#e5f0f7")
  ,value = nrow(data_needed_pro)
    ,full_screen = F
)
```

### Column {width="15%"}

```{r}
bslib::value_box(
  title = "% Complete or Near Complete"
  ,theme = bslib::value_box_theme(bg = "#016FB1", fg = "#e5f0f7")
  ,value = (100*round(nrow(data_current_pro[data_current_pro$status_of_research == "Complete", ])/nrow(data_current_pro), 2)) %>%
    paste0(., "%")
    ,full_screen = F
)
```

```{r}
bslib::value_box(
  title = "Total Unique Research \nLocations"
  ,theme = bslib::value_box_theme(bg = "#016FB1", fg = "#e5f0f7")
  ,value = length(unique(data_current_pro$location))
    ,full_screen = F
)
```

```{r}
bslib::value_box(
  title = "% Not Addressed"
  ,theme = bslib::value_box_theme(bg = "#016FB1", fg = "#e5f0f7")
  ,value = (100*round(nrow(data_needed_pro[data_needed_pro$data_gap_analysis_score == "Not Addressed", ])/nrow(data_needed_pro), 2)) %>%
    paste0(., "%")
    ,full_screen = F
)
```

## Row {height="10%"}

::: cardSpecSmall
For support, issue reporting, or for features you'd like to see - contact: CONTACTS NEEDED

The data presented in this database last updated: YYYY-MM-DD
:::

# Current Projects {#current-projects orientation="rows" scrolling="false"}

## Main Body

### Columm_1 {width="60%"}

```{r}
#| title: "Research Need Snapshot (by category)"
viz_tble_crrnt_proj_shrt
```

### Columm_2 {.tabset width="40%"}

```{r}
#| title: "Projects by Location"
viz_proj_location_tree
```

```{r}
#| title: "Project Timelines"

# crosstalk::bscols(
#   widths = c(12)
viz_prj_timeline
#   ,"Note: This plot on displays projects with a valid start and end date."
# )
```


# Research Gap Analysis {#research-needs orientation="columns" scrolling="false"}

## Columm_1 {width="60%"}

```{r}
#| title: "Needs Table"
viz_tble_needs_proj_shrt_test
```

## Columm_2 {width="40%"}

```{r}
#| title: "Needs by Location"
viz_proj_location_tree_needs
```

# Explored Research Needs {#explored-research-needs orientation="columns" scrolling="false"}

## Column {.tabset width="50%"}

```{r}
#| title: "Identified Needs Snapshot"
viz_tble_needs_proj_shrt
```

```{r}
#| title: "Animal Group Completion Rate"
viz_tble_need_anmlgrp
```

## Column {.tabset width="50%"}

```{r}
#| title: Unaddressed Research Needs
viz_viz_unaddressed_needs
```

```{r}
#| title: Research Needs Gap Table
viz_tble_agg_addrssd_gap
```

# Database Center {#database-center}

##  {.tabset}

```{r}
#| title: Current Projects

viz_tble_dcntr_current
```

```{r}
#| title: Research Priorities

viz_tble_dcntr_need
```

```{r}
#| title: Acronyms List

viz_tble_dcntr_acc
```

```{r}
#| title: Terms Definition

viz_tble_dcntr_def
```

```{r}
#| title: References

viz_tble_dcntr_ref
```

##  {.unnumbered}

# Submit Project {#submit-project orientation="columns" scrolling="true"}

```{r}
bslib::layout_columns(
  col_widths = 8
  ,bslib::card(
    bslib::card_body(
      shiny::markdown("
<strong>Submit Information to the FishFORWRD Database</strong><br>
Use the following links to send project information, research needs, or corrections.    
We will QA/QC your submission and add it to the public version of the database.<br>

[Placeholder Link for Project Submission](http://google.com/)  
[Placeholder Link for Research Needs Submission](http://google.com/)  
[Placeholder Link for Corrections](http://google.com/)  

<strong>Additional Resources</strong><br>
See the links provided below for additional resources.    

[RWSC Offshore Wind and Wildlife Research Database](https://database.rwsc.org/)  
[Tethys Knowledge Base for Fish](https://tethys.pnnl.gov/knowledge-base-wind-energy?f%5B0%5D=receptor%3A280)  
[NYSERDA Mitigation Practices Database Tool](https://www.nyetwg.com/mpd-tool)  
")
    )
  )
)
```
