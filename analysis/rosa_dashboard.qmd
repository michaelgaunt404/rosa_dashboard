---
title: "Fish FORWRD Database"
format: 
  dashboard:
    embed-resources: true
    nav-buttons:
      - icon: twitter
        href: https://twitter.com/OffshoreScience
      - icon: linkedin 
        href: https://www.linkedin.com/company/responsible-offshore-science-alliance/        
      - icon: github
        href: https://github.com/michaelgaunt404/rosa_dashboard/tree/master
---

```{r echo=FALSE, message=FALSE, msg = F, warning = F, error = F}
library(gauntlet)
library(magrittr)
library(tidyverse, quietly = TRUE)

package_load_q = purrr::quietly(gauntlet::package_load)

tmp = c("tibble", "tidyverse", "magrittr","gauntlet", "targets"
        ,"bosFunctions"
        ,"reactable", "reactablefmtr", "crosstalk", "plotly", "bslib","bsicons", "htmltools") %>% 
  package_load_q()
```

```{r}
# setwd(here::here())
table_height = 500

# source(here::here("code/helpers_skankey.R"))
```

```{css}
.navbar {
background-color: #016FB1;
}

.cardSpecBig {
text-align: center;
font-size: large;
}

.cardcenter {
text-align: center;
}

.cardSpecSmall {
text-align: center;
font-size: small;
}
```


```{r}
setwd(here::here())
targets::tar_source()
targets::tar_load_everything()
```

# Welcome Page 

## Row {height = "15%"}

::: {.cardSpecBig}
Welcome to the <strong>Fish Forward Database</strong>    
Developed in Partnership by <strong>ROSA</strong> and <strong>WSP</strong>   
![](../docs/rosa_logo.jpg){width="10%"}  ![](../docs/img-png-wsp-black.png){width="5%"}
    
:::   

## Row {height="70%"}

### Column {width="60%"}

::: {.card}    
<strong>What you can do with this Dashboard</strong><br>
With this dashboard, you can easily investigate current projects and identified research needs in the Rosa database, considering various factors such as location, needs type, and more..

<strong>How to use this Dashboard</strong><br>
This dashboard is comprised of a number of tabs each with their own purpose and functionality.   
Each tab contain a number of features that either help you explore page content or visuals which provide information based on user input.   
All tables and plots are interactive and can be manipulated via the mouse.

<strong>Tab Quick Links</strong>

[Current Projects](#current-projects)<br>

+ View ongoing projects with detailed attributes, timelines, and geographical locations.

[Research Needs Gap Analysis](#research-needs)<br>

+ Identify research gaps, explore unaddressed needs linked to ongoing projects.

[Data Center](#data-center)<br>

+ Interact with raw data through user-friendly tools, and download data directly.

:::

### Column {width="15%"}

```{r}
bslib::value_box(
  title = "Total Project Count"
  ,theme = bslib::value_box_theme(bg = "#016FB1", fg = "#e5f0f7")
  ,value = nrow(data_current_pro)
)
```

```{r}
bslib::value_box(
  title = "Total Unique Research Categories"
  ,theme = bslib::value_box_theme(bg = "#016FB1", fg = "#e5f0f7")
  ,value = length(unique(data_current_pro$identified_research_need))
)
```

```{r}
bslib::value_box(
  title = "Total Identified Needs"
  ,theme = bslib::value_box_theme(bg = "#016FB1", fg = "#e5f0f7")
  ,value = nrow(data_needed_pro)
)
```

### Column {width="15%"}

```{r}
bslib::value_box(
  title = "% Complete"
  ,theme = bslib::value_box_theme(bg = "#016FB1", fg = "#e5f0f7")
  ,value = (100*round(nrow(data_current_pro[data_current_pro$status_of_research == "Complete", ])/nrow(data_current_pro), 2)) %>%
    paste0(., "%")
)
```

```{r}
bslib::value_box(
  title = "Total Unique Research \nLocations"
  ,theme = bslib::value_box_theme(bg = "#016FB1", fg = "#e5f0f7")
  ,value = length(unique(data_current_pro$location_km))
)
```

```{r}
bslib::value_box(
  title = "% Not Addressed"
  ,theme = bslib::value_box_theme(bg = "#016FB1", fg = "#e5f0f7")
  ,value = (100*round(nrow(data_needed_pro[data_needed_pro$data_gap_analysis_score == "Not Addressed", ])/nrow(data_needed_pro), 2)) %>%
    paste0(., "%")
)
```

## Row {height="10%"}

::: {.cardSpecSmall}
  
For support, issue reporting, or for features you'd like to see - contact:  CONTACTS NEEDED

The data presented in this database last updated: YYYY-MM-DD
   
:::

# Current Projects {orientation="rows" scrolling="false" #current-projects}

## Main Body

### Columm_1 {width="60%"}

```{r}
#| title: "Research Need Snapshot (by category)"
viz_tble_crrnt_proj_shrt
```

### Columm_2 {.tabset width="40%"}

```{r}
#| title: "Projects by Location"
viz_proj_location_tree
```

```{r}
#| title: "Project Timelines"
viz_prj_timeline
```

# Research Needs Gap Analysis {orientation="columns" scrolling="false" #research-needs}

## Column {.tabset width="50%"}

```{r}
#| title: Identified Needs Snapshot
viz_tble_needs_proj_shrt
```

```{r}
#| title: Animal Group Completion Rate
viz_tble_need_anmlgrp
```

## Column {width="50%"}

### Row {height="45%"}

### {.tabset}

```{r}
#| title: Unaddressed Research Needs
viz_viz_unaddressed_needs
```

```{r}
#| title: Research Needs Gap Table
viz_tble_agg_addrssd_gap
```

### Row {height="55%"}

```{r}
viz_tble_agg_needs_animal_cmplt
```

# Data Center {#data-center}

##  {.tabset}

```{r}
#| title: Current Projects

data_current_pro  = data_current_pro %>% 
  select(!c(location_mg, location, project_budget, project_start_year, project_end_year, count)) %>%  
  rename_with(~str_remove(.x, "_mg") %>% str_remove("_km")) 

id = "current_projects"
reactable(
  data_current_pro %>% rename_with(strg_pretty_char)
  ,columns = combined_named_lists(
    # colDef_agg(cols = c(as.character(1:28), 'Grand Total'), rm_footer = T)
    colDef_urlLink(cols = rtrn_cols(data_current_pro, "website"), link_text = "Link to site")
    ,colDef_minwidth(cols = rtrn_cols(data_current_pro, "objectives|notes|method"), width = 600)
    ,colDef_minwidth(cols = rtrn_cols(data_current_pro, "title|partner_ent"), width = 200)
    ,colDef_sticky(col = "Research Project Id Number", side = "left"))
  ,defaultColDef = colDef(footerStyle = list(fontWeight = "bold"))
  ,wrap = T
  ,elementId = id
) %>%
  rctble_format_table() %>%
  rctble_add_download(., id = id)
```

```{r}
#| title: Identified Needed Projects

data_needed_pro = data_needed_pro %>% 
  select(!c(existing_project_addressing_need_id_number, data_gap_analysis_score, count)) %>%  
  rename_with(~str_remove(.x, "_mg") %>% str_remove("_km")) 


id = "project_needs"
reactable(
  data_needed_pro %>% rename_with(strg_pretty_char)
  ,columns = combined_named_lists(
    # colDef_agg(cols = c(as.character(1:28), 'Grand Total'), rm_footer = T)
    # colDef_urlLink(cols = rtrn_cols(data_current_pro, "website"), link_text = "Link to site")
    colDef_sticky(col = "Research Need Id Number", side = "left")
    ,colDef_minwidth(cols = rtrn_cols(data_needed_pro, "addressing|status"), width = 200)
    ,colDef_minwidth(cols = rtrn_cols(data_needed_pro, "summary|explanation"), width = 600)
  )
  ,defaultColDef = colDef(footerStyle = list(fontWeight = "bold"))
  ,wrap = T
  ,elementId = id
) %>%
  rctble_format_table() %>%
  rctble_add_download(., id = id)
```

```{r}
#| title: Acronyms List

id = "acronyms_list"
reactable(
  data_acro_list_pro %>% rename_with(strg_pretty_char)
  # ,columns = combined_named_lists(
    # colDef_agg(cols = c(as.character(1:28), 'Grand Total'), rm_footer = T)
    # colDef_urlLink(cols = rtrn_cols(data_current_pro, "website"), link_text = "Link to site")
    # ,colDef_sticky(col = "Research Project Id Number", side = "right"))
  ,defaultColDef = colDef(footerStyle = list(fontWeight = "bold"))
  ,wrap = F
  ,elementId = id
) %>%
  rctble_format_table() %>%
  rctble_add_download(., id = id)
```

```{r}
#| title: Terms Definition

id = "terms_definition"
reactable(
  data_def_terms_pro %>% rename_with(strg_pretty_char) %>% .[,c(1:3)]
  # ,columns = combined_named_lists(
  #   # colDef_agg(cols = c(as.character(1:28), 'Grand Total'), rm_footer = T)
  #   colDef_urlLink(cols = rtrn_cols(data_current_pro, "website"), link_text = "Link to site")
  #   ,colDef_sticky(col = "Research Project Id Number", side = "right"))
  ,defaultColDef = colDef(footerStyle = list(fontWeight = "bold"))
  ,wrap = T
  ,elementId = id
) %>%
  rctble_format_table() %>%
  rctble_add_download(., id = id)
```

```{r}
#| title: References

id = "references"
reactable(
  data_references_pro %>%  select(!c('database_notes')) %>% rename_with(strg_pretty_char)
  # ,columns = combined_named_lists(
  #   # colDef_agg(cols = c(as.character(1:28), 'Grand Total'), rm_footer = T)
  #   colDef_urlLink(cols = rtrn_cols(data_current_pro, "website"), link_text = "Link to site")
  #   ,colDef_sticky(col = "Research Project Id Number", side = "right"))
  ,defaultColDef = colDef(footerStyle = list(fontWeight = "bold"))
  ,wrap = F
  ,elementId = id
) %>%
  rctble_format_table() %>%
  rctble_add_download(., id = id)
```

##  {.unnumbered}
